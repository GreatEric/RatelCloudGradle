'use strict';
import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
var DOMProcess = /** @class */ (function () {
    function DOMProcess() {
        this.domURL = window.URL;
        this.imageType = 'image/png';
    }
    DOMProcess.prototype.appendToBody = function (element) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                document.body.appendChild(element);
                return [2 /*return*/, element];
            });
        });
    };
    DOMProcess.prototype.canvasToImage = function (canvas) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var url;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        url = canvas.toDataURL(this.imageType);
                        return [4 /*yield*/, this.dataUrlToImage(url)];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    DOMProcess.prototype.clearCanvasRect = function (canvas) {
        var context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
    };
    DOMProcess.prototype.dataUrlToImage = function (url) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var image = new Image();
                        image.onload = function () {
                            resolve(image);
                        };
                        image.onerror = reject;
                        image.src = url;
                    })];
            });
        });
    };
    DOMProcess.prototype.clipImageToCanvas = function (image, clipStartX, clipStartY, clipWidth, clipHeight) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var canvas, context;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.createCanvas(Math.abs(clipWidth), Math.abs(clipHeight))];
                    case 1:
                        canvas = _a.sent();
                        context = canvas.getContext('2d');
                        context.drawImage(image, clipStartX, clipStartY, clipWidth, clipHeight, 0, 0, canvas.width, canvas.height);
                        this.remove(image);
                        return [2 /*return*/, canvas];
                }
            });
        });
    };
    DOMProcess.prototype.createCanvas = function (width, height) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var canvas;
            return tslib_1.__generator(this, function (_a) {
                canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                return [2 /*return*/, canvas];
            });
        });
    };
    DOMProcess.prototype.downloadByUrl = function (url, filename) {
        var downloadLink = document.createElement('a');
        downloadLink.href = url;
        downloadLink.download = filename;
        downloadLink.target = '_blank';
        downloadLink.click();
        downloadLink.remove();
        this.domURL.revokeObjectURL(url);
    };
    DOMProcess.prototype.downloadCanvas = function (canvas, filename) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var downloadUrl;
            return tslib_1.__generator(this, function (_a) {
                downloadUrl = canvas.toDataURL(this.imageType);
                this.downloadByUrl(downloadUrl, filename);
                return [2 /*return*/, canvas];
            });
        });
    };
    DOMProcess.prototype.getStyle = function (element, property) {
        var styles = window.getComputedStyle(element);
        return styles[property];
    };
    DOMProcess.prototype.remove = function (element) {
        if (element) {
            element.remove();
        }
        element = null;
    };
    DOMProcess.prototype.isTransparent = function (element) {
        var backgroundColor = window.getComputedStyle(element).backgroundColor;
        return backgroundColor === 'transparent' || backgroundColor === '' || backgroundColor === 'rgba(0, 0, 0, 0)';
    };
    DOMProcess.prototype.listenInteractiveCanvas = function (canvas, rectBackground, mouseupListener, mousedownListener, contextmenuListener) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var context, rect, dragging, draw, mousedown, mousemove, mouseup, contextmenu, touchStart, touched, touchMove;
            return tslib_1.__generator(this, function (_a) {
                context = canvas.getContext('2d');
                rect = {
                    startX: 0,
                    startY: 0,
                    w: 0,
                    h: 0
                };
                dragging = false;
                draw = function () {
                    context.beginPath();
                    context.fillStyle = rectBackground;
                    context.fillRect(rect.startX, rect.startY, rect.w, rect.h);
                    context.closePath();
                };
                mousedown = function (e) {
                    context.clearRect(0, 0, canvas.width, canvas.height);
                    rect.startX = e.pageX - canvas.offsetLeft;
                    rect.startY = e.pageY - canvas.offsetTop;
                    mousedownListener(rect);
                    rect.w = 0;
                    rect.h = 0;
                    dragging = true;
                };
                mousemove = function (e) {
                    if (dragging) {
                        rect.w = e.pageX - canvas.offsetLeft - rect.startX;
                        rect.h = e.pageY - canvas.offsetTop - rect.startY;
                        context.clearRect(0, 0, canvas.width, canvas.height);
                        draw();
                    }
                };
                mouseup = function () {
                    dragging = false;
                    mouseupListener(canvas, rect);
                };
                contextmenu = function (e) {
                    contextmenuListener();
                    e.preventDefault();
                    return false;
                };
                touchStart = function (e) {
                    e.preventDefault();
                    var touch = e.changedTouches[0];
                    var mouseEvent = new MouseEvent('mousedown', {
                        clientX: touch.pageX,
                        clientY: touch.pageY
                    });
                    canvas.dispatchEvent(mouseEvent);
                };
                touched = function () {
                    var mouseEvent = new MouseEvent('mouseup', {});
                    canvas.dispatchEvent(mouseEvent);
                };
                touchMove = function (e) {
                    e.preventDefault();
                    var touch = e.changedTouches[0];
                    var mouseEvent = new MouseEvent('mousemove', {
                        clientX: touch.pageX,
                        clientY: touch.pageY
                    });
                    canvas.dispatchEvent(mouseEvent);
                };
                canvas.addEventListener('mousedown', mousedown, false);
                canvas.addEventListener('mouseup', mouseup, false);
                canvas.addEventListener('mousemove', mousemove, false);
                canvas.addEventListener('touchstart', touchStart, false);
                canvas.addEventListener('touchend', touched, false);
                canvas.addEventListener('touchmove', touchMove, false);
                canvas.addEventListener('contextmenu', contextmenu, false);
                document.body.addEventListener('touchmove', function (event) { return event.preventDefault(); }, false);
                return [2 /*return*/, canvas];
            });
        });
    };
    DOMProcess.prototype.setCanvasStyle = function (canvas, left, top, background, zIndex) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                canvas.style.cursor = 'crosshair';
                canvas.style.position = 'absolute';
                canvas.style.left = left + 'px';
                canvas.style.top = top + 'px';
                canvas.style.background = background;
                canvas.style.zIndex = zIndex;
                canvas.style.opacity = '0.5';
                return [2 /*return*/, canvas];
            });
        });
    };
    DOMProcess.prototype.setToolboxPositionStyle = function (toolboxElement, left, top) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                toolboxElement.style.left = left + 'px';
                toolboxElement.style.top = top + 'px';
                return [2 /*return*/, toolboxElement];
            });
        });
    };
    DOMProcess.prototype.setToolboxStackStyle = function (toolboxElement, zIndex) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_a) {
                toolboxElement.style.position = 'absolute';
                toolboxElement.style.zIndex = zIndex;
                return [2 /*return*/, toolboxElement];
            });
        });
    };
    DOMProcess = tslib_1.__decorate([
        Injectable(),
        tslib_1.__metadata("design:paramtypes", [])
    ], DOMProcess);
    return DOMProcess;
}());
export { DOMProcess };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyZWVuc2hvdC51dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nMi1zY3JlZW5zaG90LyIsInNvdXJjZXMiOlsibGliL3NjcmVlbnNob3QudXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOztBQUViLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0M7SUFHSTtRQUZRLFdBQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQ3BCLGNBQVMsR0FBRyxXQUFXLENBQUM7SUFDakIsQ0FBQztJQUNWLGlDQUFZLEdBQWxCLFVBQW1CLE9BQTBCOzs7Z0JBQ3pDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNuQyxzQkFBTyxPQUFPLEVBQUM7OztLQUNsQjtJQUVLLGtDQUFhLEdBQW5CLFVBQW9CLE1BQXlCOzs7Ozs7d0JBQ25DLEdBQUcsR0FBVyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQzt3QkFDOUMscUJBQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBQTs0QkFBckMsc0JBQU8sU0FBOEIsRUFBQzs7OztLQUN6QztJQUVELG9DQUFlLEdBQWYsVUFBZ0IsTUFBeUI7UUFDckMsSUFBTSxPQUFPLEdBQTZCLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFSyxtQ0FBYyxHQUFwQixVQUFxQixHQUFXOzs7Z0JBQzVCLHNCQUFPLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07d0JBQy9CLElBQU0sS0FBSyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7d0JBQzFCLEtBQUssQ0FBQyxNQUFNLEdB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RyxNQUFNLENBQUM7Z0JBQ3JDLHNCQUFPLGNBQWMsRUFBQzs7O0tBQ3pCO0lBeE1RLFVBQVU7UUFEdEIsVUFBVSxFQUFFOztPQUNBLFVBQVUsQ0F5TXRCO0lBQUQsaUJBQUM7Q0FBQSxBQXpNRCxJQXlNQztTQXpNWSxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5pbXBvcnQgeyBSZWN0IH0gZnJvbSAnLi9zY3JlZW5zaG90LmludGVyZmFjZSc7XHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIERPTVByb2Nlc3Mge1xyXG4gICAgcHJpdmF0ZSBkb21VUkwgPSB3aW5kb3cuVVJMO1xyXG4gICAgcHJpdmF0ZSBpbWFnZVR5cGUgPSAnaW1hZ2UvcG5nJztcclxuICAgIGNvbnN0cnVjdG9yKCkge31cclxuICAgIGFzeW5jIGFwcGVuZFRvQm9keShlbGVtZW50OiBIVE1MQ2FudmFzRWxlbWVudCk6IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQ+IHtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGNhbnZhc1RvSW1hZ2UoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCk6IFByb21pc2U8SFRNTEltYWdlRWxlbWVudD4ge1xyXG4gICAgICAgIGNvbnN0IHVybDogc3RyaW5nID0gY2FudmFzLnRvRGF0YVVSTCh0aGlzLmltYWdlVHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZGF0YVVybFRvSW1hZ2UodXJsKTtcclxuICAgIH1cclxuXHJcbiAgICBjbGVhckNhbnZhc1JlY3QoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZGF0YVVybFRvSW1hZ2UodXJsOiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoaW1hZ2UpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpbWFnZS5vbmVycm9yID0gcmVqZWN0O1xyXG4gICAgICAgICAgICBpbWFnZS5zcmMgPSB1cmw7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgY2xpcEltYWdlVG9DYW52YXMoXHJcbiAgICAgICAgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQsXHJcbiAgICAgICAgY2xpcFN0YXJ0WDogbnVtYmVyLFxyXG4gICAgICAgIGNsaXBTdGFydFk6IG51bWJlcixcclxuICAgICAgICBjbGlwV2lkdGg6IG51bWJlcixcclxuICAgICAgICBjbGlwSGVpZ2h0OiBudW1iZXJcclxuICAgICkge1xyXG4gICAgICAgIGNvbnN0IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgPSBhd2FpdCB0aGlzLmNyZWF0ZUNhbnZhcyhNYXRoLmFicyhjbGlwV2lkdGgpLCBNYXRoLmFicyhjbGlwSGVpZ2h0KSk7XHJcbiAgICAgICAgY29uc3QgY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIGNsaXBTdGFydFgsIGNsaXBTdGFydFksIGNsaXBXaWR0aCwgY2xpcEhlaWdodCwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICB0aGlzLnJlbW92ZShpbWFnZSk7XHJcbiAgICAgICAgcmV0dXJuIGNhbnZhcztcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBjcmVhdGVDYW52YXMod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PiB7XHJcbiAgICAgICAgY29uc3QgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIGNhbnZhcztcclxuICAgIH1cclxuXHJcbiAgICBkb3dubG9hZEJ5VXJsKHVybDogc3RyaW5nLCBmaWxlbmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgZG93bmxvYWRMaW5rOiBIVE1MQW5jaG9yRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgICAgICBkb3dubG9hZExpbmsuaHJlZiA9IHVybDtcclxuICAgICAgICBkb3dubG9hZExpbmsuZG93bmxvYWQgPSBmaWxlbmFtZTtcclxuICAgICAgICBkb3dubG9hZExpbmsudGFyZ2V0ID0gJ19ibGFuayc7XHJcbiAgICAgICAgZG93bmxvYWRMaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgZG93bmxvYWRMaW5rLnJlbW92ZSgpO1xyXG4gICAgICAgIHRoaXMuZG9tVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGRvd25sb2FkQ2FudmFzKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsIGZpbGVuYW1lOiBzdHJpbmcpOiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PiB7XHJcbiAgICAgICAgY29uc3QgZG93bmxvYWRVcmwgPSBjYW52YXMudG9EYXRhVVJMKHRoaXMuaW1hZ2VUeXBlKTtcclxuICAgICAgICB0aGlzLmRvd25sb2FkQnlVcmwoZG93bmxvYWRVcmwsIGZpbGVuYW1lKTtcclxuICAgICAgICByZXR1cm4gY2FudmFzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFN0eWxlKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBwcm9wZXJ0eTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3Qgc3R5bGVzOiBhbnkgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KTtcclxuICAgICAgICByZXR1cm4gc3R5bGVzW3Byb3BlcnR5XTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmUoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBlbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbGVtZW50ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpc1RyYW5zcGFyZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgYmFja2dyb3VuZENvbG9yOiBzdHJpbmcgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5iYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICAgICAgcmV0dXJuIGJhY2tncm91bmRDb2xvciA9PT0gJ3RyYW5zcGFyZW50JyB8fCBiYWNrZ3JvdW5kQ29sb3IgPT09ICcnIHx8IGJhY2tncm91bmRDb2xvciA9PT0gJ3JnYmEoMCwgMCwgMCwgMCknO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGxpc3RlbkludGVyYWN0aXZlQ2FudmFzKFxyXG4gICAgICAgIGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsXHJcbiAgICAgICAgcmVjdEJhY2tncm91bmQ6IHN0cmluZyB8IENhbnZhc0dyYWRpZW50IHwgQ2FudmFzUGF0dGVybixcclxuICAgICAgICBtb3VzZXVwTGlzdGVuZXI6IGFueSxcclxuICAgICAgICBtb3VzZWRvd25MaXN0ZW5lcjogYW55LFxyXG4gICAgICAgIGNvbnRleHRtZW51TGlzdGVuZXI6IGFueVxyXG4gICAgKTogUHJvbWlzZTxIVE1MQ2FudmFzRWxlbWVudD4ge1xyXG4gICAgICAgIGNvbnN0IGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgIGNvbnN0IHJlY3Q6IFJlY3QgPSB7XHJcbiAgICAgICAgICAgIHN0YXJ0WDogMCxcclxuICAgICAgICAgICAgc3RhcnRZOiAwLFxyXG4gICAgICAgICAgICB3OiAwLFxyXG4gICAgICAgICAgICBoOiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgZHJhZ2dpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgY29uc3QgZHJhdyA9ICgpID0+IHtcclxuICAgICAgICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSByZWN0QmFja2dyb3VuZDtcclxuICAgICAgICAgICAgY29udGV4dC5maWxsUmVjdChyZWN0LnN0YXJ0WCwgcmVjdC5zdGFydFksIHJlY3QudywgcmVjdC5oKTtcclxuICAgICAgICAgICAgY29udGV4dC5jbG9zZVBhdGgoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBtb3VzZWRvd24gPSAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBjb250ZXh0LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgICAgICByZWN0LnN0YXJ0WCA9IGUucGFnZVggLSBjYW52YXMub2Zmc2V0TGVmdDtcclxuICAgICAgICAgICAgcmVjdC5zdGFydFkgPSBlLnBhZ2VZIC0gY2FudmFzLm9mZnNldFRvcDtcclxuICAgICAgICAgICAgbW91c2Vkb3duTGlzdGVuZXIocmVjdCk7XHJcbiAgICAgICAgICAgIHJlY3QudyA9IDA7XHJcbiAgICAgICAgICAgIHJlY3QuaCA9IDA7XHJcbiAgICAgICAgICAgIGRyYWdnaW5nID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBtb3VzZW1vdmUgPSAoZTogTW91c2VFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZHJhZ2dpbmcpIHtcclxuICAgICAgICAgICAgICAgIHJlY3QudyA9IGUucGFnZVggLSBjYW52YXMub2Zmc2V0TGVmdCAtIHJlY3Quc3RhcnRYO1xyXG4gICAgICAgICAgICAgICAgcmVjdC5oID0gZS5wYWdlWSAtIGNhbnZhcy5vZmZzZXRUb3AgLSByZWN0LnN0YXJ0WTtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICBkcmF3KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBtb3VzZXVwID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBkcmFnZ2luZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtb3VzZXVwTGlzdGVuZXIoY2FudmFzLCByZWN0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBjb250ZXh0bWVudSA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnRleHRtZW51TGlzdGVuZXIoKTtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgdG91Y2hTdGFydCA9IChlOiBUb3VjaEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgY29uc3QgdG91Y2ggPSBlLmNoYW5nZWRUb3VjaGVzWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBtb3VzZUV2ZW50ID0gbmV3IE1vdXNlRXZlbnQoJ21vdXNlZG93bicsIHtcclxuICAgICAgICAgICAgICAgIGNsaWVudFg6IHRvdWNoLnBhZ2VYLFxyXG4gICAgICAgICAgICAgICAgY2xpZW50WTogdG91Y2gucGFnZVlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNhbnZhcy5kaXNwYXRjaEV2ZW50KG1vdXNlRXZlbnQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IHRvdWNoZWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBuZXcgTW91c2VFdmVudCgnbW91c2V1cCcsIHt9KTtcclxuICAgICAgICAgICAgY2FudmFzLmRpc3BhdGNoRXZlbnQobW91c2VFdmVudCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgdG91Y2hNb3ZlID0gKGU6IFRvdWNoRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBjb25zdCB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBuZXcgTW91c2VFdmVudCgnbW91c2Vtb3ZlJywge1xyXG4gICAgICAgICAgICAgICAgY2xpZW50WDogdG91Y2gucGFnZVgsXHJcbiAgICAgICAgICAgICAgICBjbGllbnRZOiB0b3VjaC5wYWdlWVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY2FudmFzLmRpc3BhdGNoRXZlbnQobW91c2VFdmVudCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIG1vdXNlZG93biwgZmFsc2UpO1xyXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgbW91c2V1cCwgZmFsc2UpO1xyXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBtb3VzZW1vdmUsIGZhbHNlKTtcclxuICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRvdWNoU3RhcnQsIGZhbHNlKTtcclxuICAgICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0b3VjaGVkLCBmYWxzZSk7XHJcbiAgICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRvdWNoTW92ZSwgZmFsc2UpO1xyXG4gICAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIGNvbnRleHRtZW51LCBmYWxzZSk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBldmVudCA9PiBldmVudC5wcmV2ZW50RGVmYXVsdCgpLCBmYWxzZSk7XHJcbiAgICAgICAgcmV0dXJuIGNhbnZhcztcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzZXRDYW52YXNTdHlsZShcclxuICAgICAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxyXG4gICAgICAgIGxlZnQ6IG51bWJlcixcclxuICAgICAgICB0b3A6IG51bWJlcixcclxuICAgICAgICBiYWNrZ3JvdW5kOiBzdHJpbmcsXHJcbiAgICAgICAgekluZGV4OiBzdHJpbmdcclxuICAgICk6IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQ+IHtcclxuICAgICAgICBjYW52YXMuc3R5bGUuY3Vyc29yID0gJ2Nyb3NzaGFpcic7XHJcbiAgICAgICAgY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgICAgICBjYW52YXMuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xyXG4gICAgICAgIGNhbnZhcy5zdHlsZS50b3AgPSB0b3AgKyAncHgnO1xyXG4gICAgICAgIGNhbnZhcy5zdHlsZS5iYWNrZ3JvdW5kID0gYmFja2dyb3VuZDtcclxuICAgICAgICBjYW52YXMuc3R5bGUuekluZGV4ID0gekluZGV4O1xyXG4gICAgICAgIGNhbnZhcy5zdHlsZS5vcGFjaXR5ID0gJzAuNSc7XHJcbiAgICAgICAgcmV0dXJuIGNhbnZhcztcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzZXRUb29sYm94UG9zaXRpb25TdHlsZSh0b29sYm94RWxlbWVudDogSFRNTEVsZW1lbnQsIGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIpOiBQcm9taXNlPEhUTUxFbGVtZW50PiB7XHJcbiAgICAgICAgdG9vbGJveEVsZW1lbnQuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnO1xyXG4gICAgICAgIHRvb2xib3hFbGVtZW50LnN0eWxlLnRvcCA9IHRvcCArICdweCc7XHJcbiAgICAgICAgcmV0dXJuIHRvb2xib3hFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHNldFRvb2xib3hTdGFja1N0eWxlKHRvb2xib3hFbGVtZW50OiBIVE1MRWxlbWVudCwgekluZGV4OiBzdHJpbmcpOiBQcm9taXNlPEhUTUxFbGVtZW50PiB7XHJcbiAgICAgICAgdG9vbGJveEVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICAgIHRvb2xib3hFbGVtZW50LnN0eWxlLnpJbmRleCA9IHpJbmRleDtcclxuICAgICAgICByZXR1cm4gdG9vbGJveEVsZW1lbnQ7XHJcbiAgICB9XHJcbn1cclxuIl19