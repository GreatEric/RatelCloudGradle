!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("dom-to-image"),require("jquery")):"function"==typeof define&&define.amd?define("ng2-screenshot",["exports","@angular/common","@angular/core","dom-to-image","jquery"],e):e((t=t||self)["ng2-screenshot"]={},t.ng.common,t.ng.core,t.domtoimage,t.jq)}(this,(function(t,e,n,o,r){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;function i(t,e,n,o){var r,i=arguments.length,s=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(i<3?r(s):i>3?r(e,n,s):r(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function s(t,e){return function(n,o){e(n,o,t)}}function a(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function c(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{c(o.next(t))}catch(t){i(t)}}function a(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(s,a)}c((o=o.apply(t,e||[])).next())}))}function u(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var l=function(){function t(){this.filename="screenshot.png",this.cancelText="Cancel",this.downloadText="Download"}return t=i([n.Injectable()],t)}(),d=function(){function t(){this.gray="#898b89",this.lightGray="#e6e3e3"}return t=i([n.Injectable()],t)}(),h=function(){function t(){this.top=1,this.second=0}return t=i([n.Injectable()],t)}(),f=function(){function t(){this.domURL=window.URL,this.imageType="image/png"}return t.prototype.appendToBody=function(t){return c(this,void 0,void 0,(function(){return u(this,(function(e){return document.body.appendChild(t),[2,t]}))}))},t.prototype.canvasToImage=function(t){return c(this,void 0,void 0,(function(){var e;return u(this,(function(n){switch(n.label){case 0:return e=t.toDataURL(this.imageType),[4,this.dataUrlToImage(e)];case 1:return[2,n.sent()]}}))}))},t.prototype.clearCanvasRect=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)},t.prototype.dataUrlToImage=function(t){return c(this,void 0,void 0,(function(){return u(this,(function(e){return[2,new Promise((function(e,n){var o=new Image;o.onload=function(){e(o)},o.onerror=n,o.src=t}))]}))}))},t.prototype.clipImageToCanvas=function(t,e,n,o,r){return c(this,void 0,void 0,(function(){var i;return u(this,(function(s){switch(s.label){case 0:return[4,this.createCanvas(Math.abs(o),Math.abs(r))];case 1:return i=s.sent(),i.getContext("2d").drawImage(t,e,n,o,r,0,0,i.width,i.height),this.remove(t),[2,i]}}))}))},t.prototype.createCanvas=function(t,e){return c(this,void 0,void 0,(function(){var n;return u(this,(function(o){return(n=document.createElement("canvas")).width=t,n.height=e,[2,n]}))}))},t.prototype.downloadByUrl=function(t,e){var n=document.createElement("a");n.href=t,n.download=e,n.target="_blank",n.click(),n.remove(),this.domURL.revokeObjectURL(t)},t.prototype.downloadCanvas=function(t,e){return c(this,void 0,void 0,(function(){var n;return u(this,(function(o){return n=t.toDataURL(this.imageType),this.downloadByUrl(n,e),[2,t]}))}))},t.prototype.getStyle=function(t,e){return window.getComputedStyle(t)[e]},t.prototype.remove=function(t){t&&t.remove(),t=null},t.prototype.isTransparent=function(t){var e=window.getComputedStyle(t).backgroundColor;return"transparent"===e||""===e||"rgba(0, 0, 0, 0)"===e},t.prototype.listenInteractiveCanvas=function(t,e,n,o,r){return c(this,void 0,void 0,(function(){var i,s,a,c,l,d,h,f,p,g,v;return u(this,(function(u){return i=t.getContext("2d"),s={startX:0,startY:0,w:0,h:0},a=!1,c=function(){i.beginPath(),i.fillStyle=e,i.fillRect(s.startX,s.startY,s.w,s.h),i.closePath()},l=function(e){i.clearRect(0,0,t.width,t.height),s.startX=e.pageX-t.offsetLeft,s.startY=e.pageY-t.offsetTop,o(s),s.w=0,s.h=0,a=!0},d=function(e){a&&(s.w=e.pageX-t.offsetLeft-s.startX,s.h=e.pageY-t.offsetTop-s.startY,i.clearRect(0,0,t.width,t.height),c())},h=function(){a=!1,n(t,s)},f=function(t){return r(),t.preventDefault(),!1},p=function(e){e.preventDefault();var n=e.changedTouches[0],o=new MouseEvent("mousedown",{clientX:n.pageX,clientY:n.pageY});t.dispatchEvent(o)},g=function(){var e=new MouseEvent("mouseup",{});t.dispatchEvent(e)},v=function(e){e.preventDefault();var n=e.changedTouches[0],o=new MouseEvent("mousemove",{clientX:n.pageX,clientY:n.pageY});t.dispatchEvent(o)},t.addEventListener("mousedown",l,!1),t.addEventListener("mouseup",h,!1),t.addEventListener("mousemove",d,!1),t.addEventListener("touchstart",p,!1),t.addEventListener("touchend",g,!1),t.addEventListener("touchmove",v,!1),t.addEventListener("contextmenu",f,!1),document.body.addEventListener("touchmove",(function(t){return t.preventDefault()}),!1),[2,t]}))}))},t.prototype.setCanvasStyle=function(t,e,n,o,r){return c(this,void 0,void 0,(function(){return u(this,(function(i){return t.style.cursor="crosshair",t.style.position="absolute",t.style.left=e+"px",t.style.top=n+"px",t.style.background=o,t.style.zIndex=r,t.style.opacity="0.5",[2,t]}))}))},t.prototype.setToolboxPositionStyle=function(t,e,n){return c(this,void 0,void 0,(function(){return u(this,(function(o){return t.style.left=e+"px",t.style.top=n+"px",[2,t]}))}))},t.prototype.setToolboxStackStyle=function(t,e){return c(this,void 0,void 0,(function(){return u(this,(function(n){return t.style.position="absolute",t.style.zIndex=e,[2,t]}))}))},t=i([n.Injectable(),a("design:paramtypes",[])],t)}(),p=r,g=function(){function t(t,e,r,i){var s=this;this.colors=t,this.hightLevelZindex=e,this.defaultOptions=r,this.domprocess=i,this.isOpenChange=new n.EventEmitter,this.api=new n.EventEmitter,this.showToolbox=!1,this.cancelText="Cancel",this.downloadText="Download",this.filename="screenshot.png",this.toolboxMargin=5,this.calculateToolboxPosition=function(t,e,n,o,r){var i=t+n.startX+n.w,a=e+n.startY+n.h;return n.w>=0&&(i-=o),n.h>=0?a+=s.toolboxMargin:a=a-r-s.toolboxMargin,{left:i,top:a}},this.cancel=function(){s.showToolbox=!1,s.domprocess.clearCanvasRect(s.interactiveCanvas)},this.download=function(){s.isOpenChange.emit(!1),window.setTimeout((function(){var t=s.getElementSelector()[0],e=s.getOptions(t);o.toPng(t,e).then(s.domprocess.dataUrlToImage).then((function(t){return s.domprocess.remove(t),s.domprocess.clipImageToCanvas(t,s.rect.startX,s.rect.startY,s.rect.w,s.rect.h)})).then((function(t){return s.domprocess.downloadCanvas(t,s.toolboxOptions.filename)})).then(s.domprocess.remove).catch((function(t){return console.error(t)}))}))},this.downloadFull=function(){s.isOpenChange.emit(!1),window.setTimeout((function(){var t=s.getElementSelector()[0],e=s.getOptions(t);o.toPng(t,e).then((function(t){return s.domprocess.downloadByUrl(t,s.toolboxOptions.filename)})).catch((function(t){return console.error(t)}))}))},this.findMaxZindex=function(){var t=0;return p("body *").each((function(){var e=p(this).css("zIndex"),n=parseInt(e,10);n&&n>t&&(t=n)})),t},this.getElementSelector=function(){return s.target?p(s.target):p(s.container.nativeElement).filter((function(t,e){return"screenshot-toolbox"!==e.tagName.toLowerCase()}))},this.getOptions=function(t){var e=t.getBoundingClientRect(),n={width:e.width,height:e.height};if(s.domprocess.isTransparent(t)){var o=s.domprocess.getStyle(t,"backgroundColor");n=Object.assign({},n,{bgcolor:o})}return n},this.setHightLevelZindex=function(){var t=s.findMaxZindex();s.hightLevelZindex.second=t+1,s.hightLevelZindex.top=s.hightLevelZindex.second+1},this.toPng=function(t){return new Promise((function(e,n){s.isOpenChange.emit(!1),window.setTimeout((function(){var r=s.getElementSelector()[0],i=s.getOptions(r);return o.toPng(r,i).then(s.domprocess.dataUrlToImage).then((function(t){return s.domprocess.remove(t),s.domprocess.clipImageToCanvas(t,s.rect.startX,s.rect.startY,s.rect.w,s.rect.h)})).then((function(n){var o=n.toDataURL("image/png");t&&t(o),e(o)})).catch((function(t){console.error(t),n(t)}))}))}))},this.canvasMousedownListener=function(){s.showToolbox=!1},this.canvasMouseupListener=function(t,e){if(0!==e.w&&0!==e.h){s.rect=e;var n=p(s.container.nativeElement).find("ng2-screenshot-toolbox");console.log(n.outerWidth());var o=n.get(0);console.log(o.clientWidth),console.log(s.hightLevelZindex),s.domprocess.setToolboxStackStyle(o,s.hightLevelZindex.top.toString()).then((function(n){var o=s.calculateToolboxPosition(t.offsetLeft,t.offsetTop,e,n.offsetWidth,n.offsetHeight);return s.domprocess.setToolboxPositionStyle(n,o.left,o.top)})).then((function(t){s.showToolbox=!0}))}},this.canvasContextmenuListener=function(){s.isOpenChange.emit(!1)},this.closeScreenshot=function(){s.domprocess.remove(s.interactiveCanvas),s.showToolbox=!1},this.resizeCanvas=function(){if(s.interactiveCanvas){var t=s.getElementSelector(),e=t[0].getBoundingClientRect(),n=e.width,o=e.height,r=t.offset(),i=r.left,a=r.top;s.interactiveCanvas.width=n,s.interactiveCanvas.height=o,s.domprocess.setCanvasStyle(s.interactiveCanvas,i,a,s.colors.gray,s.hightLevelZindex.second.toString()).then((function(){return s.showToolbox=!1}))}}}return t.prototype.ngOnInit=function(){var t=this;this.toolboxOptions||(this.toolboxOptions={filename:this.defaultOptions.filename,cancelText:this.defaultOptions.cancelText,downloadText:this.defaultOptions.downloadText}),this.api.emit({cancel:this.cancel,download:this.download,downloadFull:this.downloadFull,toPng:this.toPng}),window.onresize=function(){t.resizeCanvas()}},t.prototype.ngOnChanges=function(t){var e=t.isOpen,n=t.toolboxOptions;switch(e.currentValue){case!0:this.openScreenshot();break;case!1:default:this.closeScreenshot()}n&&(this.cancelText=n.cancelText?n.cancelText:this.cancelText,this.downloadText=n.downloadText?n.downloadText:this.downloadText,this.filename=n.filename?n.filename:this.filename)},t.prototype.openScreenshot=function(){var t=this,e=this.getElementSelector(),n=e[0].getBoundingClientRect(),o=n.width,r=n.height,i=e.offset(),s=i.left,a=i.top;this.setHightLevelZindex(),this.domprocess.createCanvas(o,r).then((function(e){return t.domprocess.setCanvasStyle(e,s,a,t.colors.gray,t.hightLevelZindex.second.toString())})).then(this.domprocess.appendToBody).then((function(e){return t.domprocess.listenInteractiveCanvas(e,t.colors.lightGray,t.canvasMouseupListener,t.canvasMousedownListener,t.canvasContextmenuListener)})).then((function(e){return t.interactiveCanvas=e}))},t.ctorParameters=function(){return[{type:d,decorators:[{type:n.Inject,args:[n.forwardRef((function(){return d}))]}]},{type:h,decorators:[{type:n.Inject,args:[n.forwardRef((function(){return h}))]}]},{type:l,decorators:[{type:n.Inject,args:[n.forwardRef((function(){return l}))]}]},{type:f,decorators:[{type:n.Inject,args:[n.forwardRef((function(){return f}))]}]}]},i([n.ViewChild("container",{static:!1}),a("design:type",n.ElementRef)],t.prototype,"container",void 0),i([n.Input("target"),a("design:type",String)],t.prototype,"target",void 0),i([n.Input("isOpen"),a("design:type",Boolean)],t.prototype,"isOpen",void 0),i([n.Input("toolboxOptions"),a("design:type",Object)],t.prototype,"toolboxOptions",void 0),i([n.Output("isOpenChange"),a("design:type",Object)],t.prototype,"isOpenChange",void 0),i([n.Output("apiInitialized"),a("design:type",Object)],t.prototype,"api",void 0),t=i([n.Component({selector:"ng2-screenshot",template:"<div #container><ng-content></ng-content></div>"}),s(0,n.Inject(n.forwardRef((function(){return d})))),s(1,n.Inject(n.forwardRef((function(){return h})))),s(2,n.Inject(n.forwardRef((function(){return l})))),s(3,n.Inject(n.forwardRef((function(){return f})))),a("design:paramtypes",[d,h,l,f])],t)}(),v=function(){function t(t){this.parent=t,this.hasContent=!1}return t.prototype.cancel=function(){this.parent.cancel()},t.prototype.download=function(){this.parent.download()},t.prototype.ngAfterViewInit=function(){var t=this;window.setTimeout((function(){t.hasContent=t.wrapper.nativeElement.children.length>0}))},t.ctorParameters=function(){return[{type:g,decorators:[{type:n.Inject,args:[g]}]}]},i([n.ViewChild("wrapper",{static:!1}),a("design:type",n.ElementRef)],t.prototype,"wrapper",void 0),t=i([n.Component({selector:"ng2-screenshot-toolbox",template:'\n        <div class="screenshot-toolbox" [hidden]="!parent.showToolbox">\n            <div #wrapper>\n                <ng-content></ng-content>\n            </div>\n            <div *ngIf="!hasContent">\n                <button class="btn" type="button" (click)="cancel()">\n                    Cancel\n                </button>\n                <button class="btn" type="button" (click)="download()">\n                    Download\n                </button>\n            </div>\n        </div>\n    ',styles:['/*! Angular Screenshot - v0.1.0 - http://weihanchen.github.io/ng2-screenshot - (c) 2017 weihanchen - MIT */.screenshot-toolbox{width:100%}.screenshot-toolbox button{margin:.2em}.screenshot-toolbox .btn{position:relative;padding:.2em .4em;overflow:hidden;border-width:0;outline:0;border-radius:.2em;box-shadow:0 .1em .2em #4f4f4f;background-color:#e6e3e3;color:#4f4f4f;-webkit-transition:background-color .3s;transition:background-color .3s}.screenshot-toolbox .btn:focus,.screenshot-toolbox .btn:hover{background:#cdcccc}.screenshot-toolbox .btn>*{position:relative}.screenshot-toolbox .btn:before{content:"";position:absolute;top:50%;left:50%;display:block;width:0;padding-top:0;border-radius:100%;background-color:rgba(205,204,204,.3);-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.screenshot-toolbox .btn:active:before{width:120%;padding-top:120%;-webkit-transition:width .2s ease-out,padding-top .2s ease-out;transition:width .2s ease-out,padding-top .2s ease-out}.screenshot-toolbox .btn-navy{background-color:#1d9e74}.screenshot-toolbox .btn-navy:focus,.screenshot-toolbox .btn-navy:hover{background-color:#138661}.screenshot-toolbox-custom{visibility:hidden}']}),s(0,n.Inject(g)),a("design:paramtypes",[g])],t)}(),m=function(){function t(){}return t=i([n.NgModule({imports:[e.CommonModule],declarations:[g,v],exports:[g,v],providers:[d,h,l,f,g]})],t)}();t.Ng2ScreenshotModule=m,t.ɵa=g,t.ɵb=l,t.ɵc=d,t.ɵd=h,t.ɵe=f,t.ɵf=v,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng2-screenshot.umd.min.js.map